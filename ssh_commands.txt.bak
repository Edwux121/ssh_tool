Interface + DHCP
----
#Skriptas turi paimti laisvą IP ir subnetą

uci set network.test50=interface
uci set network.test50.metric='7' #dinamiškai pajemam
uci set network.test50.ipaddr='192.168.30.1' #nurodomas appse
uci set network.test50.netmask='255.255.255.0'
uci set network.test50.delegate='1'
uci set network.test50.force_link='0'
uci set network.test50.proto='static'
uci set dhcp.test50=dhcp
uci set dhcp.test50.start='100'
uci set dhcp.test50.leasetime='12h'
uci set dhcp.test50.limit='51'
uci set dhcp.test50.interface='test50' #random dedam?
uci commit

VLAN
----
#Skriptas turi paimti laisva port ir vlan ID

uci add network switch_vlan
uci set network.@switch_vlan[{highest_vlan_str}].device='switch0'
uci set network.@switch_vlan[{highest_vlan_str}].vlan='{highest_vlan_plus_str}' #dinamiškai
uci set network.@switch_vlan[{highest_vlan_str}].vid='{highest_vlan_plus_str}' #dinamiškai
uci set network.@switch_vlan[{highest_vlan_str}].ports='0t {port_number_str}' #dinamiškai
uci commit

#VLAN priskyrimas
uci set network.test50.device='eth0.{highest_vlan_plus_str}' #dinamiškai gaunamas turi būti
uci commit


Reikia komandų:

1. Metrikos: awk '/metric/ { if ($NF > max) max = $NF } END { print max }' /etc/config/network
2. Paskutinį VLAN portą naudojama awk '/vid/ { if ($NF > max) max = $NF } END { print max }' /etc/config/network (atspausdina naudojamą ID = port, configinant reikia uci komandoje nurodyti vienu skaičiu mažesnį
3. VLAN fizinį eth awk '/vid/ { if ($NF > max) max = $NF } END { print max }' pridedam viena

stdin, stdout, stderr = client.exec_command("awk '/metric/ { if ($NF > max) max = $NF } END { gsub(/[^0-9]/, "", max); print max }' /etc/config/network")

-----

L2TP

-----

Firewall:

1. Sukuriamas nauja Firewall zona
2. Allow forward to destination zones: lan ir WAN
3. Allow forward from source zones: lan
4. Firewall Traffic rule praleidžianti 1701 port

----

VPN:

1. Sukuriam serverį
2. Sukuriam client (tik username ir password arba paprašyti įvesti šią info)

Komandos:

uci add xl2tpd bbbb
uci set xl2tpd.bbbb=service
uci set xl2tpd.bbbb.type='server'
uci set xl2tpd.bbbb.limit='192.168.0.30' # pagal nurodytą IP
uci set xl2tpd.bbbb.localip='192.168.0.1' # įvedamas
uci set xl2tpd.bbbb.start='192.168.0.20' # pagal nurodytą IP
uci set xl2tpd.bbbb._name='bbbb'
uci set xl2tpd.bbbb.chap='0'
uci set xl2tpd.bbbb.enabled='1'

uci add xl2tpd login
uci set xl2tpd.@login[0].username='test'
uci set xl2tpd.@login[0].password='test12345'
uci set xl2tpd.@login[0].remoteip='192.168.1.1'

uci commit